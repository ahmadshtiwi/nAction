<div class="row">
    <div class="col-1"><a class="btn" (click)="goBack()"> <i class="bi bi-arrow-left-circle-fill"></i> back</a></div>

    @if(id){
    <div class="col-12">
        <div class="card w-100 mb-3" style="max-width: 600px;">
            <div class="card-header bg-primary text-white">
                <div class="row">
                    <div class="col-6">
                        <h5 class="card-title mb-0">Task: {{ WorkLogTask.id  }} - {{  WorkLogTask.title }}</h5>
                    </div>
                    <div class="col-6">
                        <h5 class="text-white">Project: {{ WorkLogTask.projectName }}</h5>
                    </div>
                </div>
            </div>
            <div class="card-body row p-2 w-100 m-0">

                <div class="col-3">
                <p class="card-text col-10"><strong>Description: </strong>{{WorkLogTask.description}}</p>
                </div>
                <div class="col-3">
                     <p class="card-text col-10"><strong>Creation Date: </strong> {{ WorkLogTask.createdOn | date:'dd/MM/yyyy' }} </p>
                     <p class="card-text col-10"><strong>Do Not Start Before: </strong> {{ WorkLogTask.startDate | date:'dd/MM/yyyy' }} </p>
                     <p class="card-text col-10"><strong>Deadline: </strong> {{ WorkLogTask.maxDeliveryDate | date:'dd/MM/yyyy' }}</p>
                     <p class="card-text col-10"><strong>Actual Completion: </strong> {{ WorkLogTask.actualCompletion | date:'dd/MM/yyyy' }}</p>
                </div>
                <div class="col-3">
                    <p class="card-text col-10"><strong>Estimated Duration: </strong> {{WorkLogTask.estimatedDuration }}hrs</p>
                    <p class="card-text col-10"><strong>Actual Duration: </strong> {{WorkLogTask.actualDurationFormatted }} </p>
                    <p class="card-text col-10"><strong>Completion %age: </strong>  {{WorkLogTask.percentageCompleted}}%</p>
                    <p class="card-text col-10"><strong>Task Status: </strong> {{ WorkLogTask.assignmentStatusName }}</p>

                </div>
                <div class="col-1"><strong>Attachments</strong></div>
             
                <div class="col-2">
                    <div class="col-12 ">
                    @if (WorkLogTask.hasAttachments) {
                     <app-attachmnet [viewInputField]="false" (batchId)="getBatchId($event)" [label]="' '" [attachmentType]="attachmentType.Assignment" [hasAttachments]="WorkLogTask.hasAttachments" [referenceId]="WorkLogTask.id"></app-attachmnet>
                    } 
                    </div>
                </div>

             
           
            </div>
            <div class="card-footer d-flex justify-content-between">
                <small>Assigned to: {{ WorkLogTask.assignedToName }}</small>
                <small>Requested by: {{ WorkLogTask.createdByName }}</small>
            </div>
        </div>
    </div>

    <div class="col-12">
        <app-table [tableData]="tableData" [collectionSize]="pagination.totalCount" [page]="pagination.pageNumber"
            [pageSize]="pagination.pageSize" [tableHeaderTitle]="tableHeaderTitle" [removeAddButton]="false"
            [viewUnsubmittedRequestButton]="false" [tableHeaderButton]="'Create new workLog'"
            [actionItems]="actionItems" [removeActions]="false" [tableHeaders]="tableHeadersTask"
            [displayColumns]="displayColumns" [isViewOnly]="false" [viewUnsubmittedRequestButton]="false"
            (pageChangeEvent)="nextPage($event)" [removeFilter]="true"
            (addButtonEvent)="openModal(content , false , true , false)">
        </app-table>
    </div>
    }@else {
    <div class="col-12">
        <app-table [tableData]="tableData" [collectionSize]="pagination.totalCount" [page]="pagination.pageNumber"
            [isLog]="true" [btnName]="'View'" [idName]="'assignmentId'" [pageSize]="pagination.pageSize"
            [tableHeaderTitle]="tableHeaderTitle" [removeAddButton]="true" [viewUnsubmittedRequestButton]="false"
            [tableHeaderButton]="'Create new workLog'" [actionItems]="actionItems" [removeActions]="true"
            [tableHeaders]="tableHeadersDaily" [displayColumns]="displayColumns1" [isViewOnly]="false"
            [viewUnsubmittedRequestButton]="false" (pageChangeEvent)="nextPage($event)" (filterChanged)="onFilterChange($event)" [columnFilters]="columnFilters" (activateFilteration)="filterData()"
            (addButtonEvent)="openModal(content , false , true , false)"
            (openFilterModalEvent)="openModal(filter , true , false , false)">
        </app-table>
    </div>
    }
</div>

<ng-template #content let-offcanvas>
    <div class="offcanvas-header">
        <h4 class="offcanvas-title text-white">CreateLog</h4>
        <button type="button" class="btn-close text-white" aria-label="Close"
            (click)="offcanvas.dismiss('Cross click')"></button>
    </div>
    <div class="offcanvas-body">
        <div class="container-fluid">


            <form #workLogsForm="ngForm" AutoFormError (ngSubmit)="submitRequest(workLogsForm)">

                <div class="col-12">
                    <label class="text-white required-label my-2" for="description">{{'Description'}}</label>
                    <input [disabled]="isView" [name]="'description'" [(ngModel)]="workLog.description" required
                        class="border text-start text-black p-2 w-100" type="text">
                </div>
                <div class="col-12">
                    <label class="text-white required-label my-2" for="Date">{{'Date'}}</label>
                    <input [disabled]="isView" [name]="'Date'" [(ngModel)]="workLog.date" required
                        class="border text-start text-black p-2 w-100" type="date" [max]="today"
                        (change)="validateDate() ; workLog.fromTime = null ; workLog.toTime = null">

                    @if (viewValidation) {
                    <span class="text-danger">
                        cant enter future date
                    </span>
                    }
                </div>

                <div class="col-12">
                    <label class="text-white required-label my-2" for="fromTime">{{'From time'}}</label>
                    <input [disabled]="isView" [name]="'fromTime'" [(ngModel)]="workLog.fromTime" required
                        class="border text-start text-black p-2 w-100" type="time" (ngModelChange)="validateTime()">
                </div>

                <div class="col-12">
                    <label class="text-white required-label my-2" for="toTime">{{'To time'}}</label>
                    <input [disabled]="isView" [name]="'toTime'" [(ngModel)]="workLog.toTime" required
                        class="border text-start text-black p-2 w-100" type="time" [min]="workLog.fromTime"
                        [max]="currentTime" (ngModelChange)="workLog.date < today ? null : validateTime()">
                    <div *ngIf="timeError" class="text-danger">
                        To time must be greater than From time and cannot exceed the current time.
                    </div>
                </div>



                <div class="col-12">
                    <label class="text-white required-label my-2" for="percentageCompleted">{{'Completion %'}}</label>
                    <input [disabled]="isView" [name]="'percentageCompleted'" [(ngModel)]="workLog.percentageCompleted"
                        [appMaxValue]="100" required appRestrictNonNumeric
                        class="border text-start text-black p-2 w-100" type="text">
                </div>


                <div class="col-12">
                    <app-attachmnet (batchId)="getBatchId($event)" [attachmentType]="attachmentType.WorkLog"
                        [hasAttachments]="workLog.hasAttachments" [referenceId]="referenceId"></app-attachmnet>
                </div>

                @if(!isView){
                <div class="col-12 d-flex justify-content-center mt-3">
                    <button class="system-button btn p-2 w-100 text-white" type="submit">
                        <span class="form-label">{{'Submit Request'}}</span>
                    </button>
                </div>
                }
            </form>
        </div>
    </div>
</ng-template>

<ng-template #filter let-offcanvas>
    <div class="offcanvas-header">
        <h4 class="offcanvas-title text-white">Log Filter</h4>
        <button type="button" class="btn-close text-white" aria-label="Close"
            (click)="offcanvas.dismiss('Cross click')"></button>
    </div>
    <div class="offcanvas-body">
        <div class="container-fluid">


            <form #workLogsForm="ngForm" AutoFormError (ngSubmit)="getEmployeeData()">


                <div class="col-12">
                    <label class="text-white required-label my-2" for="fromCity">{{'employee name'}}</label>
                    <ng-select name="maxDeliveryDate" [placeholder]="'CHOOSE'"
                        class="bg-dark-primary border text-primary" [(ngModel)]="pagination.SearchValue" [items]="users"
                        [bindLabel]="'fullName'" [bindValue]="'fullName'" [multiple]="false">
                    </ng-select>
                </div>

                <div class="col-12">
                    <label class="text-white required-label my-2" for="description">{{'Date from'}}</label>
                    <input [disabled]="isView" [name]="'fromDate'" [(ngModel)]="pagination.fromDate"
                        class="border text-start text-black p-2 w-100" type="date">
                </div>

                <div class="col-12">
                    <label class="text-white required-label my-2" for="description">{{'Date to'}}</label>
                    <input [disabled]="isView" [name]="'toDate'" [(ngModel)]="pagination.toDate"
                        class="border text-start text-black p-2 w-100" type="date">
                </div>

                @if(!isView){
                <div class="col-12 d-flex justify-content-center mt-3">
                    <button class="system-button btn p-2 w-100 text-white" type="submit">
                        <span class="form-label">{{'Submit Request'}}</span>
                    </button>
                </div>
                }
            </form>
        </div>
    </div>
</ng-template>